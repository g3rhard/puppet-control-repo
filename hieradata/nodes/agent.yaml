---
classes:
  - nginx
  - php

nginx::config::vhost_purge: true
nginx::config::confd_purge: true

# vdomain: example.com

nginx::resource::server:
  'test-proxy.local':
    ensure: present
    ipv6_enable: false
    proxy: 'http://test-proxy'

nginx::nginx_vhosts:
  'test-vhosts.local':
    ssl: true
    proxy: 'http://test-vhosts'

# nginx::nginx_vhosts:
#   "%{hiera('vdomain')}":
#     ensure: present
#     rewrite_www_to_non_www: true
#     www_root: "/srv/www/%{hiera('vdomain')}/"
#     try_files:
#       - '$uri'
#       - '$uri/'
#       - '/index.php$is_args$args'

# nginx::nginx_locations:
#   'server-status':
#     ensure: present
#     vhost: "%{hiera('vdomain')}"
#     location: /server-status
#     stub_status: true
#     location_cfg_append:
#       access_log: off
#       allow: 127.0.0.1
#       deny: all

php::ensure: present
php::manage_repos: true
php::fpm: true
php::fpm_user: 'www-data'
php::fpm_group: 'www-data'
php::dev: true
php::composer: true
php::pear: true
php::phpunit: false
# php::settings:
#   'PHP/max_execution_time': '90'
#   'PHP/max_input_time': '300'
#   'PHP/memory_limit': '64M'
#   'PHP/post_max_size': '32M'
#   'PHP/upload_max_filesize': '32M'
#   'Date/date.timezone': 'UTC'
php::extensions:
  bcmath: {}
  xmlrpc: {}
  imagick:
    provider: pecl
  memcached:
    provider: pecl
    header_packages:
      - libmemcached-dev
  apc:
    provider: pecl
    settings:
      'apc/stat': 1
      'apc/stat_ctime': 1
    sapi: 'fpm'
php::fpm::pools:
  www:
    listen: '127.0.0.1:9000'
